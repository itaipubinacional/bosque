<html>

<head>

    <link rel="stylesheet" href="ol.css" type="text/css">

    <style>
        div.map {
        height: 100%;
        width: 100%;
        }
        .ol-attribution button,
        .ol-attribution u {
        display: none;
        }
    </style>

    <script src="ol.js" type="text/javascript"></script>
    <script src="jquery.min.js" type="text/javascript"></script>
    <script src="jquery.mobile-1.4.4.min.js"></script>

</head>

<body style="margin: 0">

<div id="map" class="map" />

<script type="text/javascript">
        var layersAdd = [];

        var markersAdd = [];

        var view = new ol.View({
            center: ol.proj.transform([-54.1394, -24.7568], 'EPSG:4326', 'EPSG:3857'),
            zoom: 7
        });

        map = new ol.Map({
            target: 'map',
            layers: [
                new ol.layer.Tile({
                    source: new ol.source.OSM()
                })
            ],
            view: view,

        });

        function showLayer(url, name, title, checked) {
            if (checked == 'true') {
                var wmsSource = new ol.source.TileWMS({
                    url: url,
                    params: {
                        'LAYERS': name
                    },
                });

                var wmsLayer = new ol.layer.Tile({
                    source: wmsSource
                });

                map.addLayer(wmsLayer);

                layersAdd.push({
                    'wmsLayer': wmsLayer,
                    'wmsSource': wmsSource,
                    'name': name,
                    'title': title
                });
            } else {
                for (i in layersAdd) {
                    if (layersAdd[i].name == name) {
                        map.removeLayer(layersAdd[i].wmsLayer);
                        layersAdd.splice(i, 1);
                    }
                }
            }

        }

        function showUserMarker(latitude, longitude) {

            zoomToArea(parseFloat(latitude), parseFloat(longitude));

            var iconFeature = new ol.Feature({
                geometry: new ol.geom.Point(ol.proj.transform([parseFloat(longitude), parseFloat(latitude)], 'EPSG:4326', 'EPSG:3857')),
                name: 'User Location'
            });

            //create the style
            var iconStyle = new ol.style.Style({
                image: new ol.style.Icon(({
                    size: [48, 48],
                    src: 'http://iconshow.me/media/images/Mixed/small-n-flat-icon/png2/48/-map-marker.png'
                }))
            });

            var vectorSource = new ol.source.Vector({
                features: [iconFeature]
            });

            //add the feature vector to the layer vector, and apply a style to whole layer
            var vectorLayer = new ol.layer.Vector({
                source: vectorSource,
                style: iconStyle
            });

            map.addLayer(vectorLayer);

        }

        function showMarker(lat, lon, name, icon, markerId) {

            var layerIcon = "file:///android_res/drawable/"+icon;

             $('#oi').html(layerIcon);

            var iconFeature = new ol.Feature({
                geometry: new ol.geom.Point([lat, lon]),
                layerName: name,
                markerId: markerId
            });

            //create the style
            var iconStyle = new ol.style.Style({
                image: new ol.style.Icon( /** @type {olx.style.IconOptions} */ ({
                    size: [48, 48],
                    src: layerIcon
                }))
            });

            var vectorSource = new ol.source.Vector({
                features: [iconFeature]
            });

            //add the feature vector to the layer vector, and apply a style to whole layer
            var vectorLayer = new ol.layer.Vector({
                source: vectorSource,
                style: iconStyle
            });

            map.addLayer(vectorLayer);

            markersAdd.push({
                'vectorLayer': vectorLayer,
                'name': name
            });

        }

        function closeMarker(name) {
            for (i in markersAdd) {
                if (markersAdd[i].name == name) {
                    map.removeLayer(markersAdd[i].vectorLayer);
                }
            }
        }

        $(function() {
            $("div.map").bind("taphold", tapholdHandler);

            $.event.special.tap.tapholdThreshold = 1000,
                $.event.special.swipe.durationThreshold = 2000;

            function tapholdHandler(event) {

                var getPosition = false;

                app.vibrateOnSelect();

                map.on('click', function(evt) {

                    if (!getPosition) {
                        var feature = map.forEachFeatureAtPixel(evt.pixel, function(feature, layer) {
                            return feature;
                        });

                        var listUrls = [];
                        var listTitles = [];

                        if (layersAdd.length > 0) {

                            for (var i in layersAdd) {
                                var url = layersAdd[i].wmsSource.getGetFeatureInfoUrl(
                                    evt.coordinate, view.getResolution(), view.getProjection(), {
                                        'INFO_FORMAT': 'application/json'
                                    });

                                listUrls.push(decodeURIComponent(url));
                                listTitles.push(layersAdd[i].title);
                            }

                        }

                        if (feature && listUrls.length > 0) {
                            app.showInformation(parseInt(feature.getProperties().markerId), feature.getProperties().layerName, listUrls, listTitles);
                        } else if (!feature && listUrls.length > 0) {
                            app.showInformation(null, null, listUrls, listTitles);
                        } else if (feature && listUrls.length == 0) {
                            app.showInformation(parseInt(feature.getProperties().markerId), feature.getProperties().layerName, null, null);
                        }

                        getPosition = true;
                    }

                });
            }
        });

        function zoomToArea(latitude, longitude) {
            var pan = ol.animation.pan({
                source: view.getCenter()
            });
            var coordinates = ol.proj.transform([longitude, latitude], 'EPSG:4326', 'EPSG:3857');
            map.beforeRender(pan);
            view.setCenter(coordinates);
            view.setZoom(18);
        }
    </script>

</body>

</html>